# Claude Code エージェントチーム ガイド

## エージェントチームとは？

Claude Code の**エージェントチーム**は、複数の Claude インスタンスを「チーム」として同時に動かす機能です。

普通の使い方（1人に頼む）:

```
あなた → Claude（1人）→ 結果
```

エージェントチーム（チームに頼む）:

```
あなた → リーダー（Claude）
              ├── チームメイトA（セキュリティ担当）
              ├── チームメイトB（パフォーマンス担当）
              └── チームメイトC（テスト担当）
```

リーダーが仕事を振り分け、チームメイトが**並列で独立して作業**し、結果をまとめてくれます。

---

## まず最初に：有効化する

エージェントチームは 2024年12月にリサーチプレビューとして登場し、
2026年2月の Opus 4.6 発表時に大きくフィーチャーされましたが、
2026年2月現在も**実験的機能（experimental）**のままで、デフォルトでは無効です。

### 方法1: 環境変数で有効化

```bash
export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1
claude
```

### 方法2: settings.json で有効化

`~/.claude/settings.json` に追加:

```json
{
  "env": {
    "CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS": "1"
  }
}
```

---

## 基本的な使い方

特別なコマンドは不要です。**自然言語で頼むだけ**です。

### 例1: コードレビューを並列で行う

```
PR #42 をレビューしてほしい。3人のチームメイトを作って：
- 1人はセキュリティの観点
- 1人はパフォーマンスの観点
- 1人はテストカバレッジの観点
それぞれレビューして結果を報告して。
```

### 例2: 機能を並列で実装する

```
認証システムを実装したい。チームを作って：
- 1人はDBスキーマの変更
- 1人はAPIエンドポイント
- 1人はフロントエンド
- 1人はテスト作成
それぞれ担当ファイルを分けて並列で進めて。
```

### 例3: バグの原因を複数の仮説で同時調査

```
アプリが1メッセージ送信後に終了してしまうバグがある。
5人のチームメイトを作って、それぞれ違う仮説を調査して。
お互いの仮説を議論させて、最も有力な原因を特定して。
```

---

## チームメイトの操作方法

### 表示モード

| モード | 説明 | 必要なもの |
|--------|------|------------|
| `in-process` | メインターミナル内で動作。Shift+↑/↓ で選択 | 何もいらない |
| `split panes` | 各チームメイトが別ペインに表示 | tmux または iTerm2 |
| `auto`（デフォルト） | tmux があれば分割、なければ in-process | 自動判定 |

設定方法:

```bash
# コマンドラインで
claude --teammate-mode in-process

# または settings.json で
{
  "teammateMode": "in-process"
}
```

### よく使う操作

| やりたいこと | 方法 |
|-------------|------|
| チームメイト一覧を見る | Shift+↓ で切り替え |
| チームメイトに直接話す | Shift+↑/↓ で選んでメッセージ入力 |
| タスクを割り当てる | 「バックエンドの実装をAPIチームメイトに割り当てて」 |
| 実装前に計画を承認する | 「変更を加える前に計画を承認させて」 |
| リーダーを委任モードにする | Shift+Tab |
| チームメイトを終了する | 「researcherチームメイトを終了して」 |
| チーム全体を片付ける | 「チームをクリーンアップして」 |

---

## サブエージェントとの違い

「サブエージェント」と「エージェントチーム」は似ているようで違います。

| | サブエージェント | エージェントチーム |
|--|-----------------|-------------------|
| コミュニケーション | 結果をメインに返すだけ（一方通行） | チームメイト同士で直接やりとり可能 |
| 独立性 | メインの一部として動く | 完全に独立したセッション |
| 共有タスクリスト | なし | あり（自分でタスクを取れる） |
| トークン消費 | 少なめ（結果が要約される） | 多め（各自が独立したコンテキスト） |
| 向いている場面 | 単純な調査・検索 | 議論・協力が必要な複合タスク |

**迷ったら**: 単純なタスクはサブエージェント、複雑で議論が必要ならエージェントチーム。

---

## カスタムエージェントの作り方

チームメイトに専門的な役割を持たせたい場合、`.claude/agents/` にファイルを作ります。

### 例: セキュリティレビュー専門エージェント

`.claude/agents/security-reviewer.md`:

```markdown
---
name: security-reviewer
description: セキュリティ専門のコードレビュアー
tools: Read, Grep, Glob, Bash
model: sonnet
---

あなたはセキュリティの専門家です。以下の観点でコードをレビューしてください：
- 認証の脆弱性
- データ漏洩のリスク
- 入力値のバリデーション
- セッション管理
深刻度と具体的な修正案を報告してください。
```

---

## うまく使うコツ

### 1. チームメイトには十分なコンテキストを渡す

チームメイトはリーダーの会話履歴を**引き継がない**ので、必要な情報を明示的に伝えましょう。

```
# 悪い例
「このバグを調べて」

# 良い例
「src/auth/ の認証モジュールにあるバグを調べて。
 JWTトークンをhttpOnlyクッキーで保存している。
 ログイン後にセッションが切れる問題が報告されている。」
```

### 2. ファイルの競合を避ける

2人のチームメイトが同じファイルを編集すると上書きが発生します。**担当ファイルを分ける**のが鉄則です。

### 3. タスクの粒度を適切にする

| 粒度 | 問題 |
|------|------|
| 小さすぎる | 調整のオーバーヘッドが利益を上回る |
| 大きすぎる | チェックなしに長時間作業、手戻りリスク |
| ちょうどいい | 1つの関数、テストファイル、レビューなど自己完結する単位 |

目安: **1人あたり5〜6タスク**が生産的です。

### 4. まずは調査系タスクから試す

初めてなら、コードを書き換えないタスクから始めるのがおすすめです:
- PRレビュー
- ライブラリの調査
- バグの原因調査

### 5. 放置しない

定期的に進捗を確認し、うまくいっていないアプローチは軌道修正しましょう。

---

## どんな時にエージェントチームを使うべきか

### 使うべき場面

- 複数の観点からのコードレビュー
- 独立した複数モジュールの並列実装
- 複数の仮説を同時に検証するデバッグ
- フロントエンド・バックエンド・テストの同時作業

### 使わなくていい場面

- 単一ファイルの修正
- 簡単な質問への回答
- 1つの明確なバグ修正
- 順番に実行する必要がある作業

---

## 制限事項

- `/resume` でチームメイトは復元されない
- 1セッションにつき1チームまで
- チームメイトが自分のチームを作ることはできない（ネスト不可）
- VS Code ターミナルや Windows Terminal では分割ペインモード非対応
- トークン消費が多いので `/cost` で監視すること

---

## クイックスタート まとめ

```bash
# 1. 有効化
export CLAUDE_CODE_EXPERIMENTAL_AGENT_TEAMS=1

# 2. Claude Code を起動
claude

# 3. 自然言語でチームを作る
# 例: 「3人のチームメイトを作って、それぞれ別の観点からこのコードをレビューして」

# 4. Shift+↑/↓ でチームメイトを切り替え

# 5. 終わったら「チームをクリーンアップして」
```

これだけです。難しいAPIやコマンドを覚える必要はありません。
